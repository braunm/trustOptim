<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Quick Demo of trustOptim • trustOptim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A Quick Demo of trustOptim">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XVJF7FJCCT"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XVJF7FJCCT');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trustOptim</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.7.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/trustOptim-demo.html">Using trustOptim for Unconstrained Nonlinear Optimization with Sparse Hessians</a>
    </li>
    <li>
      <a href="../articles/trustOptim-quick.html">A Quick Demo of trustOptim</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/braunm/trustOptim/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Quick Demo of trustOptim</h1>
                        <h4 data-toc-skip class="author">Michael
Braun</h4>
            
            <h4 data-toc-skip class="date">2026-01-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/braunm/trustOptim/blob/HEAD/vignettes/trustOptim-quick.Rmd" class="external-link"><code>vignettes/trustOptim-quick.Rmd</code></a></small>
      <div class="hidden name"><code>trustOptim-quick.Rmd</code></div>

    </div>

    
    
<p>This is a quick demo of how to use the <em>trustOptim</em> package.
For this example, the objective function is the Rosenbrock function.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>x</mi><mrow><mn>1</mn><mo>:</mo><mi>N</mi></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>:</mo><mi>N</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo stretchy="true" form="prefix">[</mo><mn>100</mn><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup><mo>−</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
 f(x_{1:N},y_{1:N})=\sum_{i=1}^N
 \left[100\left(x^2_i-y_i\right)^2+\left(x_i-1\right)^2\right]
</annotation></semantics></math></p>
<p>The parameter vector contains
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>N</mi></mrow><annotation encoding="application/x-tex">2N</annotation></semantics></math>
variables ordered as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>y</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><msub><mi>y</mi><mn>2</mn></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><msub><mi>x</mi><mi>n</mi></msub><mo>,</mo><msub><mi>y</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1, y_1,
x_2, y_2, ... x_n, y_n</annotation></semantics></math>. The optimum of
the function is a vector of ones, and the value at the minimum is
zero.</p>
<p>The following functions return the objective, gradient, and Hessian
(in sparse format) of this function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://braunm.github.io/trustOptim/">trustOptim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">V</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">*</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">*</span><span class="va">N</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">-</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">V</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">*</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">*</span><span class="va">N</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">t</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">-</span><span class="va">y</span></span>
<span>    <span class="va">dxi</span> <span class="op">&lt;-</span> <span class="fl">400</span><span class="op">*</span><span class="va">t</span><span class="op">*</span><span class="va">x</span><span class="op">+</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">dyi</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">200</span><span class="op">*</span><span class="va">t</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dxi</span>,<span class="va">dyi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="op">}</span></span>
<span></span>
<span><span class="va">hess</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">V</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">*</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">V</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">*</span><span class="va">N</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">d0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">200</span>,<span class="va">N</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">d0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1200</span><span class="op">*</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">-</span><span class="fl">400</span><span class="op">*</span><span class="va">y</span><span class="op">+</span><span class="fl">2</span></span>
<span>    <span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">*</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">d1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">400</span><span class="op">*</span><span class="va">x</span></span>
<span></span>
<span>    <span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/bandSparse.html" class="external-link">bandSparse</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">N</span>,</span>
<span>                    k<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                    diagonals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">d1</span>,<span class="va">d0</span>,<span class="va">d1</span><span class="op">)</span>,</span>
<span>                    symmetric<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                    repr<span class="op">=</span><span class="st">'C'</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/drop0.html" class="external-link">drop0</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For this demo, we start at a random vector.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">N</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we call <code>trust.optim</code>, with all default
arguments.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trust.optim.html">trust.optim</a></span><span class="op">(</span><span class="va">start</span>, fn<span class="op">=</span><span class="va">f</span>, gr<span class="op">=</span><span class="va">df</span>, hs<span class="op">=</span><span class="va">hess</span>, method<span class="op">=</span><span class="st">"Sparse"</span><span class="op">)</span></span>
<span><span class="co"># Beginning optimization</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># iter            f           nrm_gr                     status</span></span>
<span><span class="co">#   1   10015.031437   10987.613876     Continuing - TR expand</span></span>
<span><span class="co">#   2   10015.031437   10987.613876   Continuing - TR contract</span></span>
<span><span class="co">#   3     219.817975    1588.461373     Continuing - TR expand</span></span>
<span><span class="co">#   4     219.817975    1588.461373   Continuing - TR contract</span></span>
<span><span class="co">#   5     219.817975    1588.461373   Continuing - TR contract</span></span>
<span><span class="co">#   6     219.817975    1588.461373   Continuing - TR contract</span></span>
<span><span class="co">#   7      82.628847     703.991138                 Continuing</span></span>
<span><span class="co">#   8      17.092097     196.558177     Continuing - TR expand</span></span>
<span><span class="co">#   9      17.092097     196.558177   Continuing - TR contract</span></span>
<span><span class="co">#  10      17.092097     196.558177   Continuing - TR contract</span></span>
<span><span class="co">#  11      17.092097     196.558177   Continuing - TR contract</span></span>
<span><span class="co">#  12      15.903949      87.156911                 Continuing</span></span>
<span><span class="co">#  13      10.985480      39.443763     Continuing - TR expand</span></span>
<span><span class="co">#  14      10.985480      39.443763   Continuing - TR contract</span></span>
<span><span class="co">#  15       9.991011      96.253959                 Continuing</span></span>
<span><span class="co">#  16       7.829903      26.847358                 Continuing</span></span>
<span><span class="co">#  17       7.829903      26.847358   Continuing - TR contract</span></span>
<span><span class="co">#  18       6.689435      33.066635     Continuing - TR expand</span></span>
<span><span class="co">#  19       6.689435      33.066635   Continuing - TR contract</span></span>
<span><span class="co">#  20       6.221075      58.822744                 Continuing</span></span>
<span><span class="co">#  21       4.451638      16.401176                 Continuing</span></span>
<span><span class="co">#  22       4.451638      16.401176   Continuing - TR contract</span></span>
<span><span class="co">#  23       3.834185      30.511945     Continuing - TR expand</span></span>
<span><span class="co">#  24       2.924576       8.993872                 Continuing</span></span>
<span><span class="co">#  25       2.924576       8.993872   Continuing - TR contract</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># iter            f           nrm_gr                     status</span></span>
<span><span class="co">#  26       2.924576       8.993872   Continuing - TR contract</span></span>
<span><span class="co">#  27       2.532653      20.239445                 Continuing</span></span>
<span><span class="co">#  28       1.786237       5.608209                 Continuing</span></span>
<span><span class="co">#  29       1.786237       5.608209   Continuing - TR contract</span></span>
<span><span class="co">#  30       1.380482       7.023595     Continuing - TR expand</span></span>
<span><span class="co">#  31       1.019554       5.780869                 Continuing</span></span>
<span><span class="co">#  32       0.725310       4.438916                 Continuing</span></span>
<span><span class="co">#  33       0.502544       4.865620                 Continuing</span></span>
<span><span class="co">#  34       0.324202       3.268843                 Continuing</span></span>
<span><span class="co">#  35       0.207341       5.565848                 Continuing</span></span>
<span><span class="co">#  36       0.111685       1.780737                 Continuing</span></span>
<span><span class="co">#  37       0.072993       7.082883                 Continuing</span></span>
<span><span class="co">#  38       0.022568       0.361306                 Continuing</span></span>
<span><span class="co">#  39       0.022568       0.361306   Continuing - TR contract</span></span>
<span><span class="co">#  40       0.022568       0.361306   Continuing - TR contract</span></span>
<span><span class="co">#  41       0.009448       2.928907     Continuing - TR expand</span></span>
<span><span class="co">#  42       0.001544       0.247652                 Continuing</span></span>
<span><span class="co">#  43       0.000153       0.498492                 Continuing</span></span>
<span><span class="co">#  44       0.000001       0.005509                 Continuing</span></span>
<span><span class="co">#  45       0.000000       0.000359                 Continuing</span></span>
<span><span class="co">#  46       0.000000       0.000000                 Continuing</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Iteration has terminated</span></span>
<span><span class="co">#  46       0.000000       0.000000                    Success</span></span></code></pre></div>
<p>In the above output, <code>f</code> is the objective function, and
<code>nrm_gr</code> is the norm of the gradient. The <code>status</code>
messages illustrate how the underlying trust region algorithm is
progressing, and are useful mainly for debugging purposes. Note that the
objective value is non-increasing at each iteration, but the norm of the
gradient is not. The algorithm will continue until either the norm of
the gradient is less than the control parameter <code>prec</code>, the
trust region radius is less than <code>stop.trust.radius</code>, or the
iteration count exceeds <code>maxit</code>. See the package manual for
details of the control parameters. We use the default control parameters
for this demo (hence, there is no control list here.</p>
<p>The result contains the objective value, the minimum, the gradient at
the minimum (should be numerically zero for all elements), and the
Hessian at the minimum.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt</span></span>
<span><span class="co"># $fval</span></span>
<span><span class="co"># [1] 2.233e-19</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $solution</span></span>
<span><span class="co"># [1] 1 1 1 1 1 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $gradient</span></span>
<span><span class="co"># [1]  2.331e-09 -1.631e-09  0.000e+00  0.000e+00  0.000e+00  0.000e+00</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $hessian</span></span>
<span><span class="co"># 6 x 6 sparse Matrix of class "dsCMatrix"</span></span>
<span><span class="co">#                                   </span></span>
<span><span class="co"># [1,]  802 -400    .    .    .    .</span></span>
<span><span class="co"># [2,] -400  200    .    .    .    .</span></span>
<span><span class="co"># [3,]    .    .  802 -400    .    .</span></span>
<span><span class="co"># [4,]    .    . -400  200    .    .</span></span>
<span><span class="co"># [5,]    .    .    .    .  802 -400</span></span>
<span><span class="co"># [6,]    .    .    .    . -400  200</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $iterations</span></span>
<span><span class="co"># [1] 46</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $status</span></span>
<span><span class="co"># [1] "Success"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $trust.radius</span></span>
<span><span class="co"># [1] 0.5006</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $nnz</span></span>
<span><span class="co"># [1] 9</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $method</span></span>
<span><span class="co"># [1] "Sparse"</span></span></code></pre></div>
<p>Note that <code>opt$fval</code>, and all elements of
<code>opt$gradient</code> are zero, within machine precision. The
solution is correct, and the Hessian is returned as a compressed sparse
Matrix object (refer to the <em>Matrix</em> package for details).</p>
<p>One way to <em>potentially</em> speed up convergence (but not
necessarily compute time) is to apply a preconditioner to the algorithm.
Other than the identity matrix (the default), the package current
supports only a modified Cholesky preconditioner. This is implemented
with a control parameter <code>preconditioner=1</code>. To save space,
we report the optimizer status only ever 10 iterations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trust.optim.html">trust.optim</a></span><span class="op">(</span><span class="va">start</span>, fn<span class="op">=</span><span class="va">f</span>, gr<span class="op">=</span><span class="va">df</span>, hs<span class="op">=</span><span class="va">hess</span>, method<span class="op">=</span><span class="st">"Sparse"</span>,</span>
<span>      control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>preconditioner<span class="op">=</span><span class="fl">1</span>, report.freq<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Beginning optimization</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># iter            f           nrm_gr                     status</span></span>
<span><span class="co">#  10      13.648174       7.496606   Continuing - TR contract</span></span>
<span><span class="co">#  20       7.151988      37.094473     Continuing - TR expand</span></span>
<span><span class="co">#  30       3.408749      18.596902     Continuing - TR expand</span></span>
<span><span class="co">#  40       0.836703      12.994474                 Continuing</span></span>
<span><span class="co">#  50       0.128263       6.112045                 Continuing</span></span>
<span><span class="co">#  60       0.000011       0.142876                 Continuing</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Iteration has terminated</span></span>
<span><span class="co">#  63       0.000000       0.000000                    Success</span></span></code></pre></div>
<p>Here, we see that adding the preconditioner actually increases the
number of iterations. Sometimes preconditioners help a lot, and
sometimes not at all.</p>
<p>##Quasi-Newton Methods</p>
<p>The <code>trust.optim</code> function also supports quasi-Newton
approximations to the Hessian. The two options are BFGS and SR1 updates.
See <span class="citation">Nocedal and Wright (2006)</span> for details.
You do not need to provide the Hessian for these methods, and they are
often preferred when the Hessian is dense. However, they may take longer
to converge, which is why we need to change the <code>maxit</code>
control parameter. To save space, we report the status of the optimizer
only every 10 iterations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt.bfgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trust.optim.html">trust.optim</a></span><span class="op">(</span><span class="va">start</span>, fn<span class="op">=</span><span class="va">f</span>, gr<span class="op">=</span><span class="va">df</span>, method<span class="op">=</span><span class="st">"BFGS"</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">5000</span>, report.freq<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Beginning optimization</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># iter            f           nrm_gr                     status</span></span>
<span><span class="co">#   10      88.806530     354.018026                 Continuing</span></span>
<span><span class="co">#   20       1.823163       6.328353   Continuing - TR contract</span></span>
<span><span class="co">#   30       1.389553       4.246382                 Continuing</span></span>
<span><span class="co">#   40       0.802565       3.855513     Continuing - TR expand</span></span>
<span><span class="co">#   50       0.571448       2.816390     Continuing - TR expand</span></span>
<span><span class="co">#   60       0.208713      10.847588   Continuing - TR contract</span></span>
<span><span class="co">#   70       0.007267       1.328120   Continuing - TR contract</span></span>
<span><span class="co">#   80       0.005292       0.670026     Continuing - TR expand</span></span>
<span><span class="co">#   90       0.000001       0.004486                 Continuing</span></span>
<span><span class="co">#  100       0.000000       0.000000                 Continuing</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Iteration has terminated</span></span>
<span><span class="co">#  101       0.000000       0.000000                    Success</span></span>
<span><span class="va">opt.bfgs</span></span>
<span><span class="co"># $fval</span></span>
<span><span class="co"># [1] 8.829e-23</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $solution</span></span>
<span><span class="co"># [1] 1 1 1 1 1 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $gradient</span></span>
<span><span class="co"># [1] -1.149e-10  6.506e-11  8.306e-12 -6.639e-12 -7.881e-11  3.622e-11</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $iterations</span></span>
<span><span class="co"># [1] 101</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $status</span></span>
<span><span class="co"># [1] "Success"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $trust.radius</span></span>
<span><span class="co"># [1] 0.3383</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $method</span></span>
<span><span class="co"># [1] "BFGS"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $hessian.update.method</span></span>
<span><span class="co"># [1] 2</span></span></code></pre></div>
<p>And we can do the same thing with SR1 updates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt.sr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trust.optim.html">trust.optim</a></span><span class="op">(</span><span class="va">start</span>, fn<span class="op">=</span><span class="va">f</span>, gr<span class="op">=</span><span class="va">df</span>, method<span class="op">=</span><span class="st">"SR1"</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">5000</span>, report.freq<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Beginning optimization</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># iter            f           nrm_gr                     status</span></span>
<span><span class="co">#   10     175.256780     287.816322   Continuing - TR contract</span></span>
<span><span class="co">#   20       2.931556       2.996846                 Continuing</span></span>
<span><span class="co">#   30       2.131656       6.411590                 Continuing</span></span>
<span><span class="co">#   40       1.127632       3.784477     Continuing - TR expand</span></span>
<span><span class="co">#   50       0.315880       6.964198                 Continuing</span></span>
<span><span class="co">#   60       0.208635       1.302632     Continuing - TR expand</span></span>
<span><span class="co">#   70       0.132457       5.187552   Continuing - TR contract</span></span>
<span><span class="co">#   80       0.108929       2.243054   Continuing - TR contract</span></span>
<span><span class="co">#   90       0.103658       0.417444     Continuing - TR expand</span></span>
<span><span class="co">#  100       0.039978       2.964965   Continuing - TR contract</span></span>
<span><span class="co">#  110       0.007481       2.932641   Continuing - TR contract</span></span>
<span><span class="co">#  120       0.006169       1.885494   Continuing - TR contract</span></span>
<span><span class="co">#  130       0.000005       0.033300   Continuing - TR contract</span></span>
<span><span class="co">#  140       0.000000       0.002521                 Continuing</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Iteration has terminated</span></span>
<span><span class="co">#  144       0.000000       0.000000                    Success</span></span>
<span><span class="va">opt.sr1</span></span>
<span><span class="co"># $fval</span></span>
<span><span class="co"># [1] 1.657e-19</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $solution</span></span>
<span><span class="co"># [1] 1 1 1 1 1 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $gradient</span></span>
<span><span class="co"># [1] -6.302e-10  3.902e-10 -4.991e-11  1.402e-10 -1.377e-08  6.698e-09</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $iterations</span></span>
<span><span class="co"># [1] 144</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $status</span></span>
<span><span class="co"># [1] "Success"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $trust.radius</span></span>
<span><span class="co"># [1] 0.005085</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $method</span></span>
<span><span class="co"># [1] "SR1"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $hessian.update.method</span></span>
<span><span class="co"># [1] 1</span></span></code></pre></div>
<p>Note that the quasi_Newton updates do not return a Hessian. We do not
think that the final approximations from BFGS or SR1 updates are
particularly reliable. If you need the Hessian, you can use the
<em>sparseHessianFD</em> package.</p>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-NocedalWright2006" class="csl-entry">
Nocedal, Jorge, and Stephen J Wright. 2006. <em>Numerical
Optimization</em>. Second edition. Springer-Verlag.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://braunm.github.io" class="external-link">Michael Braun</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
